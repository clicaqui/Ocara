SET client_encoding = 'UTF8';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;
SET search_path = public, pg_catalog;
SET default_tablespace = '';
SET default_with_oids = false;
--
CREATE TABLE action_category ( id integer NOT NULL, description character varying(40) NOT NULL);
ALTER TABLE public.action_category OWNER TO ocara;
CREATE SEQUENCE action_category_id_seq INCREMENT BY 1 NO MAXVALUE NO MINVALUE CACHE 1;
ALTER TABLE public.action_category_id_seq OWNER TO ocara;
ALTER SEQUENCE action_category_id_seq OWNED BY action_category.id;
SELECT pg_catalog.setval('action_category_id_seq', 8, true);
ALTER TABLE action_category ALTER COLUMN id SET DEFAULT nextval('action_category_id_seq'::regclass);
INSERT INTO action_category (id, description) VALUES (1, 'Computadores');
INSERT INTO action_category (id, description) VALUES (2, 'Usuários');
INSERT INTO action_category (id, description) VALUES (3, 'Movimento do Caixa');
INSERT INTO action_category (id, description) VALUES (4, 'Dívidas Abertas');
INSERT INTO action_category (id, description) VALUES (5, 'Usuários bloqueados p/ utilização');
INSERT INTO action_category (id, description) VALUES (6, 'Usuários bloqueados p/ empréstimo');
INSERT INTO action_category (id, description) VALUES (7, 'Bens Alienados');
INSERT INTO action_category (id, description) VALUES (8, 'Lista de Bens');
INSERT INTO action_category (id, description) VALUES (9, 'Relatórios');
ALTER TABLE ONLY action_category ADD CONSTRAINT action_category_pkey PRIMARY KEY (id);
--
CREATE TABLE action (id integer NOT NULL, action_category_id integer, description character varying(40) NOT NULL);
ALTER TABLE public.action OWNER TO ocara;
CREATE SEQUENCE action_id_seq INCREMENT BY 1 NO MAXVALUE NO MINVALUE CACHE 1;
ALTER TABLE public.action_id_seq OWNER TO ocara;
ALTER SEQUENCE action_id_seq OWNED BY action.id;
SELECT pg_catalog.setval('action_id_seq', 15, true);
ALTER TABLE action ALTER COLUMN id SET DEFAULT nextval('action_id_seq'::regclass);
INSERT INTO action (id, action_category_id, description) VALUES (1, 1, 'lista de computadores');
INSERT INTO action (id, action_category_id, description) VALUES (2, 1, 'editar');
INSERT INTO action (id, action_category_id, description) VALUES (3, 1, 'excluir');
INSERT INTO action (id, action_category_id, description) VALUES (4, 1, 'liberar usuário');
INSERT INTO action (id, action_category_id, description) VALUES (5, 1, 'desconectar usuário');
INSERT INTO action (id, action_category_id, description) VALUES (6, 1, 'adicionar tempo');
INSERT INTO action (id, action_category_id, description) VALUES (7, 1, 'remover tempo');
INSERT INTO action (id, action_category_id, description) VALUES (8, 1, 'ver histórico');
INSERT INTO action (id, action_category_id, description) VALUES (9, 1, 'inventariar máquina');
INSERT INTO action (id, action_category_id, description) VALUES (10, 1, 'sistema');
INSERT INTO action (id, action_category_id, description) VALUES (11, 1, 'propriedades');
INSERT INTO action (id, action_category_id, description) VALUES (12, 2, 'lista de usuários');
INSERT INTO action (id, action_category_id, description) VALUES (13, 2, 'novo');
INSERT INTO action (id, action_category_id, description) VALUES (14, 2, 'editar');
INSERT INTO action (id, action_category_id, description) VALUES (15, 2, 'excluir');
INSERT INTO action (id, action_category_id, description) VALUES (16, 2, 'adicionar tempo');
INSERT INTO action (id, action_category_id, description) VALUES (17, 2, 'remover tempo');
INSERT INTO action (id, action_category_id, description) VALUES (18, 2, 'bloquear p/ utilização');
INSERT INTO action (id, action_category_id, description) VALUES (19, 2, 'bloquear p/ empréstimo');
INSERT INTO action (id, action_category_id, description) VALUES (20, 2, 'perfil usuário');
INSERT INTO action (id, action_category_id, description) VALUES (22, 2, 'mudar senha');
INSERT INTO action (id, action_category_id, description) VALUES (23, 2, 'ver histórico');
INSERT INTO action (id, action_category_id, description) VALUES (24, 2, 'propriedades');
INSERT INTO action (id, action_category_id, description) VALUES (25, 2, 'reconstruir área de trabalho');
INSERT INTO action (id, action_category_id, description) VALUES (28, 3, 'lista de movimento de caixa');
INSERT INTO action (id, action_category_id, description) VALUES (29, 3, 'novo');
INSERT INTO action (id, action_category_id, description) VALUES (30, 4, 'lista de dívidas abertas');
INSERT INTO action (id, action_category_id, description) VALUES (31, 4, 'novo');
INSERT INTO action (id, action_category_id, description) VALUES (32, 4, 'pago');
INSERT INTO action (id, action_category_id, description) VALUES (33, 5, 'lista de bens bloqueados p/ utilização');
INSERT INTO action (id, action_category_id, description) VALUES (34, 5, 'desbloquear');
INSERT INTO action (id, action_category_id, description) VALUES (35, 6, 'lista de bens bloqueados p/ empréstimo');
INSERT INTO action (id, action_category_id, description) VALUES (36, 6, 'desbloquear');
INSERT INTO action (id, action_category_id, description) VALUES (37, 7, 'lista de bens alienados');
INSERT INTO action (id, action_category_id, description) VALUES (38, 7, 'desalienar');
INSERT INTO action (id, action_category_id, description) VALUES (39, 8, 'lista de bens');
INSERT INTO action (id, action_category_id, description) VALUES (40, 8, 'novo');
INSERT INTO action (id, action_category_id, description) VALUES (41, 8, 'editar');
INSERT INTO action (id, action_category_id, description) VALUES (42, 8, 'excluir');
INSERT INTO action (id, action_category_id, description) VALUES (43, 8, 'emprestar');
INSERT INTO action (id, action_category_id, description) VALUES (44, 8, 'reservar');
INSERT INTO action (id, action_category_id, description) VALUES (45, 8, 'alienar');
INSERT INTO action (id, action_category_id, description) VALUES (46, 8, 'devolver');
INSERT INTO action (id, action_category_id, description) VALUES (47, 8, 'propriedades');
INSERT INTO action (id, action_category_id, description) VALUES (48, 1, 'novo');
INSERT INTO action (id, action_category_id, description) VALUES (49, 4, 'excluir');
INSERT INTO action (id, action_category_id, description) VALUES (21, 2, 'manter perfil');
INSERT INTO action (id, action_category_id, description) VALUES (50, 1, 'adicionar categoria');
INSERT INTO action (id, action_category_id, description) VALUES (51, 2, 'adicionar categoria');
INSERT INTO action (id, action_category_id, description) VALUES (52, 9, 'consultar movimento de caixa');
INSERT INTO action (id, action_category_id, description) VALUES (53, 9, 'fatura de serviços não pagos');
INSERT INTO action (id, action_category_id, description) VALUES (54, 9, 'utilização de bens');
INSERT INTO action (id, action_category_id, description) VALUES (55, 9, 'utilização de máquinas');
INSERT INTO action (id, action_category_id, description) VALUES (56, 9, 'utilização de frequentadores');
INSERT INTO action (id, action_category_id, description) VALUES (57, 9, 'baixar débitos do frequentador');
ALTER TABLE ONLY action ADD CONSTRAINT action_pkey PRIMARY KEY (id);
ALTER TABLE ONLY action ADD CONSTRAINT action_category_id_fkey FOREIGN KEY (action_category_id) REFERENCES action_category(id);
--
CREATE TABLE perfil (id integer NOT NULL, perfil_description character varying(40) NOT NULL);
ALTER TABLE public.perfil OWNER TO ocara;
CREATE SEQUENCE perfil_id_seq INCREMENT BY 1 NO MAXVALUE NO MINVALUE CACHE 1;
ALTER TABLE public.perfil_id_seq OWNER TO ocara;
ALTER SEQUENCE perfil_id_seq OWNED BY perfil.id;
SELECT pg_catalog.setval('perfil_id_seq', 3, true);
ALTER TABLE perfil ALTER COLUMN id SET DEFAULT nextval('perfil_id_seq'::regclass);
INSERT INTO perfil (id, perfil_description) VALUES (2, 'Monitor');
INSERT INTO perfil (id, perfil_description) VALUES (3, 'Frequentador');
INSERT INTO perfil (id, perfil_description) VALUES (1, 'Gestor');
ALTER TABLE ONLY perfil ADD CONSTRAINT perfil_pkey PRIMARY KEY (id);
--
INSERT INTO "user" (nick, full_name, email, responsible, cpf, birth, marital_status, phone, notes, schooling, curriculo, last_login, last_machine_id, active, reg_date, login_count, sex, occupation, situation_occupation, type_deficiency, renda_familiar, etnia, credit, password, category_id, alterado, logado, "autorizoEnvio") VALUES ('gestor', 'Usuário com todas as permissões', NULL, NULL, NULL, '2012-11-5', NULL, NULL, NULL, NULL, NULL, NULL, NULL, true, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, '202cb962ac59075b964b07152d234b70', NULL, true, false, false);
--
CREATE TABLE perfil_user ( id integer NOT NULL, user_id integer, perfil_id integer );
ALTER TABLE public.perfil_user OWNER TO ocara;
CREATE SEQUENCE perfil_user_id_seq INCREMENT BY 1 NO MAXVALUE NO MINVALUE CACHE 1;
ALTER TABLE public.perfil_user_id_seq OWNER TO ocara;
ALTER SEQUENCE perfil_user_id_seq OWNED BY perfil_user.id;
SELECT pg_catalog.setval('perfil_user_id_seq', 74, true);
ALTER TABLE perfil_user ALTER COLUMN id SET DEFAULT nextval('perfil_user_id_seq'::regclass);
INSERT INTO perfil_user (user_id, perfil_id) VALUES ((select id from public.user where nick = 'gestor'), 1);
ALTER TABLE ONLY perfil_user ADD CONSTRAINT perfil_user_pkey PRIMARY KEY (id);
ALTER TABLE ONLY perfil_user ADD CONSTRAINT perfil_user_perfil_id_fkey FOREIGN KEY (perfil_id) REFERENCES perfil(id);
ALTER TABLE ONLY perfil_user ADD CONSTRAINT perfil_user_user_id_fkey FOREIGN KEY (user_id) REFERENCES "user"(id);
--
CREATE TABLE perfil_action(id serial NOT NULL, action_id integer, perfil_id integer, CONSTRAINT perfil_action_pkey PRIMARY KEY (id), CONSTRAINT perfil_action_action_id_fkey FOREIGN KEY (action_id) REFERENCES "action" (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT perfil_action_perfil_id_fkey FOREIGN KEY (perfil_id) REFERENCES perfil (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION ) WITH (OIDS=FALSE);
ALTER TABLE perfil_action OWNER TO ocara;
--
INSERT INTO perfil_action (action_id, perfil_id) VALUES (1, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (2, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (3, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (4, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (5, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (6, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (7, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (8, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (9, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (10, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (11, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (48, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (12, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (13, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (14, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (15, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (16, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (17, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (18, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (19, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (20, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (21, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (22, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (23, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (24, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (25, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (26, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (27, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (28, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (29, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (30, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (31, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (32, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (49, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (33, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (34, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (35, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (36, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (37, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (38, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (39, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (40, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (41, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (42, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (43, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (44, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (45, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (46, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (47, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (48, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (49, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (50, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (51, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (52, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (53, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (54, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (55, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (56, 1);
INSERT INTO perfil_action (action_id, perfil_id) VALUES (57, 1);
CREATE LANGUAGE plpgsql;
ALTER TABLE history ADD COLUMN deletado boolean;
CREATE OR REPLACE FUNCTION onpay_debts_machine() RETURNS trigger AS 'BEGIN UPDATE history SET deletado = TRUE WHERE day=OLD.day AND month=OLD.month AND year=OLD.year AND machine_id=OLD.machine_id AND start_time=OLD.start_time AND user_id=OLD.user_id; RETURN OLD; END;' LANGUAGE plpgsql;
CREATE TRIGGER onpay_debts_machine BEFORE DELETE ON opendebts_machine FOR EACH ROW EXECUTE PROCEDURE onpay_debts_machine();
